---
import { getCollection } from "astro:content";
import BlogShell from "../../blog/BlogShell.astro";
import LocalizedDateTime from "../../blog/LocalizedDateTime.astro";
import LocalizedDateTimeScript from "../../blog/LocalizedDateTimeScript.astro";
import { sortBlogPostsByPublicationDateDescending } from "../../blog/blog-posts.js";

const blogCollection = await getCollection("blog");
const sortedBlogPosts = sortBlogPostsByPublicationDateDescending(blogCollection);
const blogPostCount = sortedBlogPosts.length;
let blogPostCountLabel = `${blogPostCount} posts available`;

if (blogPostCount === 1) {
	blogPostCountLabel = "1 post available";
}
---

<BlogShell
	title="Christian Rackerseder â€” Blog"
	pageTitle="Blog"
	intro="Notes on web technologies, engineering decisions, and front-end architecture."
	terminalOutput={blogPostCountLabel}
>
	<div class="blog-index">
		{
			sortedBlogPosts.length > 0 ? (
				<ul class="blog-index-list">
					{sortedBlogPosts.map((blogPost) => (
						<li>
							<a class="blog-index-link" href={`/blog/${blogPost.id}`}>
								<span class="blog-index-title">{blogPost.data.title}</span>
								<span class="blog-meta">
									Published <LocalizedDateTime publishedAt={blogPost.data.publishedAt} />
								</span>
							</a>
						</li>
					))}
				</ul>
			) : (
				<p class="blog-empty-state">No blog posts published yet.</p>
			)
		}
	</div>

	<LocalizedDateTimeScript />
</BlogShell>
